
 --CREATE TABLE employee
--(
--	SSN varchar(10) PRIMARY KEY,
--	Name varchar(40) not null,
--	DeptNo int(5) not null
--);

CREATE TABLE emp(
    ssn int PRIMARY KEY,
    name varchar(10) not null,
    dno int not null
);
CREATE TABLE proj(

    pid int PRIMARY KEY,
    projArea varchar(10),
    pname varchar(10)
 );
 
 CREATE TABLE dept(
 dnum int PRIMARY KEY,
 dname varchar(10)
 );
-- FOREIGN KEY (SSN) REFERENCES employee(SSN) ON DELETE CASCADE,
 CREATE TABLE works_on(
    ssn int not null,
    pid int not null,
    hrs int,
    FOREIGN KEY (ssn) REFERENCES emp(ssn) ON DELETE CASCADE,
    FOREIGN KEY (pid) REFERENCES proj(pid) ON DELETE CASCADE
 );
 
INSERT INTO EMP(SSN,NAME,DNO) VALUES (1,'JOY',4);
INSERT INTO EMP(SSN,NAME,DNO) VALUES (2,'MARRIE',2);
INSERT INTO EMP(SSN,NAME,DNO) VALUES (3,'MFGE',3);
INSERT INTO EMP(SSN,NAME,DNO) VALUES (4,'CHANDLER',4);
INSERT INTO EMP(SSN,NAME,DNO) VALUES (5,'JOHN',3);
INSERT INTO EMP(SSN,NAME,DNO) VALUES (6,'CARRY',2);
INSERT INTO EMP(SSN,NAME,DNO) VALUES (7,'MORIE',1);
INSERT INTO EMP(SSN,NAME,DNO) VALUES (8,'MICHAL',1);

SELECT * 
FROM EMP;

INSERT INTO PROJ(PID,PROJAREA,PNAME) VALUES(1,'DATABASE','a');
INSERT INTO PROJ(PID,PROJAREA,PNAME) VALUES(2,'DATABASE','b');
INSERT INTO PROJ(PID,PROJAREA,PNAME) VALUES(3,'BIGDATA','c');
INSERT INTO PROJ(PID,PROJAREA,PNAME) VALUES(4,'CLOUD','d');
INSERT INTO PROJ(PID,PROJAREA,PNAME) VALUES(5,'SEARCH','e');
INSERT INTO PROJ(PID,PROJAREA,PNAME) VALUES(6,'CLOUD','f');
INSERT INTO PROJ(PID,PROJAREA,PNAME) VALUES(7,'BIGDATA','h');
INSERT INTO PROJ(PID,PROJAREA,PNAME) VALUES(8,'CLOUD','i');

SELECT * 
FROM PROJ;

INSERT INTO DEPT(DNUM,DNAME) VALUES(1,'A');
INSERT INTO DEPT(DNUM,DNAME) VALUES(2,'B');
INSERT INTO DEPT(DNUM,DNAME) VALUES(3,'C');
INSERT INTO DEPT(DNUM,DNAME) VALUES(4,'D');

SELECT * 
FROM DEPT;

INSERT INTO WORKS_ON(SSN,PID,HRS) VALUES(1,1,5);
INSERT INTO WORKS_ON(SSN,PID,HRS) VALUES(1,2,2);
INSERT INTO WORKS_ON(SSN,PID,HRS) VALUES(1,5,5); 
INSERT INTO WORKS_ON(SSN,PID,HRS) VALUES(2,3,5);
INSERT INTO WORKS_ON(SSN,PID,HRS) VALUES(2,8,8);
INSERT INTO WORKS_ON(SSN,PID,HRS) VALUES(3,5,5);
INSERT INTO WORKS_ON(SSN,PID,HRS) VALUES(3,4,4);
INSERT INTO WORKS_ON(SSN,PID,HRS) VALUES(3,6,5);
INSERT INTO WORKS_ON(SSN,PID,HRS) VALUES(4,7,5);
INSERT INTO WORKS_ON(SSN,PID,HRS) VALUES(4,2,1);
INSERT INTO WORKS_ON(SSN,PID,HRS) VALUES(5,5,5);
INSERT INTO WORKS_ON(SSN,PID,HRS) VALUES(5,6,5);
INSERT INTO WORKS_ON(SSN,PID,HRS) VALUES(6,1,5);
INSERT INTO WORKS_ON(SSN,PID,HRS) VALUES(7,4,5);
INSERT INTO WORKS_ON(SSN,PID,HRS) VALUES(8,4,5);
INSERT INTO WORKS_ON(SSN,PID,HRS) VALUES(8,3,5);
INSERT INTO WORKS_ON(SSN,PID,HRS) VALUES(3,2,1);

SELECT * FROM WORKS_ON;


SELECT *
FROM EMP e
WHERE e.SSN IN
(
SELECT w.SSN 
FROM WORKS_ON w
WHERE w.PID IN
(
SELECT p.PID 
FROM PROJ p
WHERE p.PROJAREA = 'DATABASE')
);

SELECT DNO,COUNT(SSN)
FROM EMP 
GROUP BY DNO;

UPDATE WORKS_ON
SET PID = 5
WHERE SSN = 2;
 
SELECT * FROM WORKS_ON ;
 



SELECT E.SSN,E.NAME
FROM EMP E
WHERE E.SSN NOT IN 
(
SELECT W.SSN
FROM WORKS_ON W 
group by W.SSN
HAVING COUNT(W.PID) > 2
);

